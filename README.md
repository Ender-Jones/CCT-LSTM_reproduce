# CCT-LSTM_reproduce

## `main.py`: Pipeline Orchestrator

This script serves as the main entry point for the entire data processing pipeline. It uses command-line arguments to execute different stages of the process.

### Pipeline Workflow

The pipeline is divided into three main steps, which should be run in order.

1.  **`check`**: Runs the dataset integrity check and creates the master manifest. This step is mandatory before proceeding.
    ```bash
    python main.py check
    ```
2.  **`extract`**: Extracts facial landmarks from all videos.
    ```bash
    python main.py extract
    ```
3.  **`process`**: Processes the extracted landmarks into MTF (Markov Transition Field) images.
    ```bash
    python main.py process
    ```

## `integrity_and_masterManifest.py`
### Check the integrity of UBFC-Phys dataset by the following logic:
1. In selected folder, if "UBFC-Phys" folder exists, then it will be used as the dataset.
2. In "UBFC-Phys", if "Data" folder exists.
3. If there are 56 folders named "s1(subject number)", "s2", ..., "s56" in "Data" folder.
4. For each subject folder:
   1. if there are 3 avi files named "vid_s1(subject number)_1.avi", "vid_s1_2.avi", "vid_s1_3.avi".
   2. if there are 3 csv files named "bvp_s1(subject number)_T1.csv", "bvp_s1_T2.csv", "bvp_s1_T3.csv".
   3. if there are 3 csv files named "eda_s1(subject number)_T1.csv", "eda_s1_T2.csv", "eda_s1_T3.csv".
   4. if there is 1 txt file named "info_s1(subject number).txt".
   5. if there is 1 csv file named "selfReportedAnx_s1(subject number).csv".
If any of the above conditions are not met, it will print an error message and exit.

### Known Dataset Discrepancies
> [!WARNING]
> During our integrity check, we identified the following issues with the official UBFC-Phys dataset downloaded from [dat@UBFC](https://search-data.ubfc.fr/FR-18008901306731-2022-05-05_UBFC-Phys-A-Multimodal-Dataset-For.html):
> - **Error in `s40`**: The file `vid_s40_T3.avi` is missing. This appears to be a naming error within the dataset itself.
> - **Error in `s56`**: The file `selfReportedAnx_s56.csv` is missing. We also noted that the self-report data in `s55` & `s56` are identical. As this self-report data is not utilized in our project, we have chosen to ignore this discrepancy.

### After integrity check, it will generate a master manifest file named "masterManifest.csv" in the selected folder.
The master manifest file will contain the following columns:
- subject: subject number
- group: 'test' or 'ctrl'

## `file_path_gen.py`
### Generate the file paths for the UBFC-Phys dataset.
The path will be based on "UBFC_data_path.txt" generated by `integrity_and_masterManifest.py` in the project root directory.  
The dataset is organized as the following structure:  
![structure.png](imgs/structure.png)
### xxx(parent folder)/UBFC-Phys/Data/s1(subject folder)/vid_s1_1.avi etc.